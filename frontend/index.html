<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>E-Voting – Login</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
<div class="wrap">
  <h1>E-Voting <span class="badge">Login</span></h1>
  <div class="nav">
    <a class="active" href="index.html">Login</a>
    <a href="elections.html">Elections</a>
    <a href="vote.html">Vote</a>
    <a href="results.html">Results</a>
    <a href="admin.html">Admin</a>

  </div>

  <div class="card">
    <h2>API Bases</h2>
    <div class="grid2">
      <div>
        <label>Auth API Base</label>
        <input id="authBase" placeholder="http://localhost:4000" />
      </div>
      <div>
        <label>Results API Base</label>
        <input id="resultsBase" placeholder="http://localhost:7000" />
      </div>
    </div>
    <button id="saveCfg">Save</button>
  </div>

  <div class="card">
    <h2>Login</h2>
    <div class="grid2">
      <div>
        <label>Email</label>
        <input id="email" placeholder="student1@uni.com" />
      </div>
      <div>
        <label>Password</label>
        <input id="password" type="password" placeholder="Voter123!" />
      </div>
    </div>
    <button id="btnLogin">Login</button>
    <pre id="out" class="mt"></pre>
  </div>
</div>

<script src="utils.js"></script>
<script>
window.addEventListener('DOMContentLoaded', () => {
  const authBaseEl    = document.getElementById('authBase');
  const resultsBaseEl = document.getElementById('resultsBase');
  const emailEl       = document.getElementById('email');
  const passEl        = document.getElementById('password');
  const btnLogin      = document.getElementById('btnLogin');
  const btnSave       = document.getElementById('saveCfg');
  const outEl         = document.getElementById('out');

  if (!authBaseEl || !resultsBaseEl || !emailEl || !passEl || !btnLogin || !btnSave || !outEl) {
    console.error('Missing one or more elements on index.html. Check IDs.');
    return;
  }

  // Prefill bases from localStorage
  authBaseEl.value    = cfg.authBase;
  resultsBaseEl.value = cfg.resultsBase;

  btnSave.onclick = () => {
    setBases(authBaseEl.value, resultsBaseEl.value);
    toast('API bases saved.', 'ok');
  };

  btnLogin.onclick = async () => {
    try {
      progressStart();
      const out = await apiPost(cfg.authBase, '/auth/login', {
        email: emailEl.value.trim(),
        password: passEl.value
      });
      cfg.jwt = out.token; saveCfg();
      outEl.textContent = JSON.stringify(out, null, 2);
      toast('Logged in — taking you to Elections…', 'ok');
      setTimeout(() => go('elections.html'), 600);
    } catch (e) {
      outEl.textContent = e.message;
      toast('Login failed', 'err');
    } finally {
      progressDone();
    }
  };
});
</script>
</body>
</html>
